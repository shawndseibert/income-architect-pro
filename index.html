<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Architect Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --emerald: #10b981;
            --emerald-glow: rgba(16, 185, 129, 0.15);
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #e5e7eb;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        .retro-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .glass {
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glow-text {
            text-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: #050505;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #333;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "recharts": "https://esm.sh/recharts@2.15.0?external=react,react-dom",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <!-- esm.sh/run allows us to run TSX directly in the browser -->
    <script type="module" src="https://esm.sh/run"></script>
    
    <script type="text/tsx">
import React, { useState, useMemo, useEffect, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { 
    PieChart, Pie, Cell, ResponsiveContainer, Tooltip as RechartsTooltip, 
    BarChart, Bar, XAxis, YAxis, 
    Treemap, RadarChart, PolarGrid, PolarAngleAxis, Radar,
    RadialBarChart, RadialBar
} from 'recharts';

// --- APPLICATION TYPES ---

enum TimeFrame {
  HOURLY = 'Hourly',
  DAILY = 'Daily',
  WEEKLY = 'Weekly',
  BIWEEKLY = 'Bi-Weekly',
  MONTHLY = 'Monthly',
  YEARLY = 'Yearly'
}

interface Expense {
  id: string;
  label: string;
  amount: number;
  frequency: TimeFrame;
  color: string;
}

interface IncomeState {
  amount: number;
  timeFrame: TimeFrame;
  isGross: boolean;
  hoursPerDay: number;
  daysPerWeek: number;
  stateCode: string;
}

// --- CONSTANTS ---

const TAX_BRACKETS = [
  { limit: 11600, rate: 0.10 },
  { limit: 47150, rate: 0.12 },
  { limit: 100525, rate: 0.22 },
  { limit: 191950, rate: 0.24 },
  { limit: 243725, rate: 0.32 },
  { limit: 609350, rate: 0.35 },
  { limit: Infinity, rate: 0.37 }
];

const STATE_TAX_RATES: Record<string, number> = {
  'NONE': 0, 'AL': 0.05, 'AZ': 0.025, 'CA': 0.08, 'FL': 0, 'NY': 0.06, 'TX': 0, 'WA': 0
};

const US_STATES = [
  { code: 'NONE', name: 'Federal Only' },
  { code: 'AL', name: 'Alabama' }, { code: 'AZ', name: 'Arizona' },
  { code: 'CA', name: 'California' }, { code: 'FL', name: 'Florida' },
  { code: 'NY', name: 'New York' }, { code: 'TX', name: 'Texas' },
  { code: 'WA', name: 'Washington' }
];

// --- UTILITIES ---

const convertToAnnual = (amount: number, timeFrame: TimeFrame, hoursPerDay = 8, daysPerWeek = 5): number => {
  if (!amount) return 0;
  switch (timeFrame) {
    case TimeFrame.HOURLY: return amount * hoursPerDay * daysPerWeek * 52;
    case TimeFrame.DAILY: return amount * daysPerWeek * 52;
    case TimeFrame.WEEKLY: return amount * 52;
    case TimeFrame.BIWEEKLY: return amount * 26;
    case TimeFrame.MONTHLY: return amount * 12;
    case TimeFrame.YEARLY: return amount;
    default: return 0;
  }
};

const calculateFederalTax = (annualGross: number): number => {
  let tax = 0;
  let remaining = annualGross;
  let prevLimit = 0;
  for (const b of TAX_BRACKETS) {
    const taxable = Math.min(remaining, b.limit - prevLimit);
    if (taxable <= 0) break;
    tax += taxable * b.rate;
    remaining -= taxable;
    prevLimit = b.limit;
  }
  return tax;
};

// --- COMPONENTS ---

const CustomTooltip = ({ active, payload }: any) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="bg-[#121212] border border-neutral-800 p-3 rounded-xl shadow-2xl backdrop-blur-md">
        <p className="text-[10px] font-black uppercase tracking-widest text-emerald-500 mb-1">{data.name}</p>
        <p className="text-sm font-bold text-white retro-mono">${Math.round(payload[0].value).toLocaleString()}</p>
      </div>
    );
  }
  return null;
};

const App = () => {
  const [income, setIncome] = useState<IncomeState>({
    amount: 0, timeFrame: TimeFrame.HOURLY, isGross: true, hoursPerDay: 8, daysPerWeek: 5, stateCode: 'NONE'
  });
  const [expenses, setExpenses] = useState<Expense[]>([]);
  const [period, setPeriod] = useState('Month');
  const [chartType, setChartType] = useState(0);

  // Persistence
  useEffect(() => {
    const saved = localStorage.getItem('income_architect_v3_final');
    if (saved) {
      const p = JSON.parse(saved);
      if (p.income) setIncome(p.income);
      if (p.expenses) setExpenses(p.expenses);
    }
  }, []);

  useEffect(() => {
    localStorage.setItem('income_architect_v3_final', JSON.stringify({ income, expenses }));
  }, [income, expenses]);

  const results = useMemo(() => {
    const grossAnnual = convertToAnnual(income.amount, income.timeFrame, income.hoursPerDay, income.daysPerWeek);
    const fedTax = income.isGross ? calculateFederalTax(grossAnnual) : 0;
    const stateTax = income.isGross ? grossAnnual * (STATE_TAX_RATES[income.stateCode] || 0) : 0;
    const netAnnual = grossAnnual - fedTax - stateTax;
    
    const expenseData = expenses.map(e => ({ name: e.label, value: convertToAnnual(e.amount, e.frequency), color: e.color }));
    const totalExp = expenseData.reduce((a, b) => a + b.value, 0);
    const takeHome = Math.max(0, netAnnual - totalExp);

    const factor = period === 'Year' ? 1 : period === 'Month' ? 1/12 : period === 'Week' ? 1/52 : 1/(income.daysPerWeek * 52);
    
    return {
      takeHome: takeHome * factor,
      gross: grossAnnual * factor,
      tax: (fedTax + stateTax) * factor,
      expenses: totalExp * factor,
      chartData: [
        { name: 'Liquid', value: takeHome * factor, color: '#10b981' },
        { name: 'Taxes', value: (fedTax + stateTax) * factor, color: '#ef4444' },
        ...expenseData.map(e => ({ ...e, value: e.value * factor }))
      ].filter(d => d.value > 0)
    };
  }, [income, expenses, period]);

  const addExpense = () => {
    const newExp: Expense = {
      id: Math.random().toString(36).substr(2, 9),
      label: 'New Bill', amount: 0, frequency: TimeFrame.MONTHLY,
      color: `hsl(${Math.random() * 360}, 70%, 50%)`
    };
    setExpenses([...expenses, newExp]);
  };

  return (
    <div className="min-h-screen pb-24">
      <nav className="fixed top-0 inset-x-0 glass z-50 px-6 py-4 flex justify-between items-center border-b border-white/5">
        <div className="flex items-center space-x-2">
          <div className="w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"></div>
          <h1 className="text-xs font-black uppercase tracking-[0.3em] text-white">Income <span className="text-emerald-500">Architect</span></h1>
        </div>
        <div className="text-[9px] font-black uppercase text-neutral-600 tracking-widest hidden sm:block">Precision Fin-Analysis</div>
      </nav>

      <main className="max-w-6xl mx-auto px-4 pt-24 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        {/* INPUT COLUMN */}
        <div className="lg:col-span-5 space-y-6 order-2 lg:order-1">
          <section className="glass p-6 rounded-3xl border-emerald-500/10">
            <h3 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60 mb-6">Revenue Parameters</h3>
            <div className="space-y-4">
              <div className="relative">
                <span className="absolute left-5 top-1/2 -translate-y-1/2 text-xl font-bold text-emerald-500 opacity-40">$</span>
                <input 
                  type="number" 
                  value={income.amount || ''} 
                  onChange={e => setIncome({...income, amount: parseFloat(e.target.value) || 0})}
                  className="w-full bg-neutral-950 border border-neutral-800 rounded-2xl py-5 pl-12 pr-4 text-3xl retro-mono text-white outline-none focus:border-emerald-500/50 transition-all"
                  placeholder="0.00"
                />
              </div>
              <div className="grid grid-cols-3 gap-2">
                <select 
                  value={income.timeFrame} 
                  onChange={e => setIncome({...income, timeFrame: e.target.value as TimeFrame})}
                  className="bg-neutral-900 border border-neutral-800 rounded-xl px-3 py-4 text-[10px] font-black uppercase text-white outline-none appearance-none"
                >
                  {Object.values(TimeFrame).map(t => <option key={t} value={t}>{t}</option>)}
                </select>
                <button 
                  onClick={() => setIncome({...income, isGross: !income.isGross})}
                  className={`rounded-xl text-[10px] font-black uppercase transition-all ${income.isGross ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/10' : 'bg-neutral-800 text-neutral-500'}`}
                >
                  {income.isGross ? 'Gross' : 'Net'}
                </button>
                <select 
                  value={income.stateCode} 
                  onChange={e => setIncome({...income, stateCode: e.target.value})}
                  className="bg-neutral-900 border border-neutral-800 rounded-xl px-3 py-4 text-[10px] font-black uppercase text-white outline-none appearance-none"
                >
                  {US_STATES.map(s => <option key={s.code} value={s.code}>{s.name}</option>)}
                </select>
              </div>
            </div>
          </section>

          <section className="glass p-6 rounded-3xl border-emerald-500/10">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60">Liability Modules</h3>
              <button 
                onClick={addExpense}
                className="bg-emerald-500/10 text-emerald-500 px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest border border-emerald-500/20 hover:bg-emerald-500/20 transition-all"
              >
                + New Asset
              </button>
            </div>
            <div className="space-y-3">
              {expenses.map(exp => (
                <div key={exp.id} className="glass p-4 rounded-2xl flex items-center justify-between border-transparent hover:border-emerald-500/20 transition-all">
                  <div className="flex items-center space-x-3">
                    <div className="w-3 h-3 rounded-full" style={{ backgroundColor: exp.color }}></div>
                    <input 
                      className="bg-transparent border-none outline-none text-sm font-bold text-white w-24"
                      value={exp.label}
                      onChange={e => {
                        const updated = expenses.map(ex => ex.id === exp.id ? {...ex, label: e.target.value} : ex);
                        setExpenses(updated);
                      }}
                    />
                  </div>
                  <div className="flex items-center space-x-3">
                    <input 
                      type="number"
                      className="bg-transparent border-none outline-none text-right text-sm retro-mono font-bold text-neutral-400 w-20"
                      value={exp.amount || ''}
                      onChange={e => {
                        const updated = expenses.map(ex => ex.id === exp.id ? {...ex, amount: parseFloat(e.target.value) || 0} : ex);
                        setExpenses(updated);
                      }}
                    />
                    <button onClick={() => setExpenses(expenses.filter(ex => ex.id !== exp.id))} className="text-neutral-700 hover:text-red-500 transition-colors">&times;</button>
                  </div>
                </div>
              ))}
              {expenses.length === 0 && <div className="py-12 text-center text-[10px] uppercase font-bold text-neutral-800">Add assets to start</div>}
            </div>
          </section>
        </div>

        {/* RESULTS COLUMN */}
        <div className="lg:col-span-7 space-y-6 order-1 lg:order-2">
          <section className="glass overflow-hidden rounded-[2.5rem] border-emerald-500/20 bg-gradient-to-br from-[#0a0a0a] to-black p-8 relative">
            <div className="flex justify-between items-start mb-8">
              <div>
                <span className="text-[10px] uppercase font-black tracking-[0.2em] text-emerald-500/80">Net Disposable ({period})</span>
                <h2 className="text-5xl md:text-7xl font-black text-white glow-text mt-2 retro-mono">
                  ${Math.round(results.takeHome).toLocaleString()}
                </h2>
              </div>
              <div className="flex bg-black/40 p-1 rounded-xl border border-white/5">
                {['Year', 'Month', 'Week', 'Day'].map(p => (
                  <button key={p} onClick={() => setPeriod(p)} className={`px-3 py-2 text-[9px] font-black uppercase rounded-lg transition-all ${period === p ? 'bg-emerald-600 text-white' : 'text-neutral-600'}`}>{p[0]}</button>
                ))}
              </div>
            </div>
            <div className="grid grid-cols-3 gap-4 pt-8 border-t border-white/5">
              <div>
                <span className="text-[9px] uppercase font-black text-neutral-600 block mb-1">Gross</span>
                <span className="text-xs font-bold retro-mono text-neutral-400">${Math.round(results.gross).toLocaleString()}</span>
              </div>
              <div>
                <span className="text-[9px] uppercase font-black text-neutral-600 block mb-1">Taxes</span>
                <span className="text-xs font-bold retro-mono text-red-500/80">${Math.round(results.tax).toLocaleString()}</span>
              </div>
              <div>
                <span className="text-[9px] uppercase font-black text-neutral-600 block mb-1">Bills</span>
                <span className="text-xs font-bold retro-mono text-blue-500/80">${Math.round(results.expenses).toLocaleString()}</span>
              </div>
            </div>
          </section>

          <section className="glass p-6 rounded-[2.5rem] min-h-[400px] flex flex-col">
            <div className="flex justify-between items-center mb-8">
              <h4 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60">Asset Distribution</h4>
              <div className="flex space-x-1.5">
                {[0,1,2].map(i => (
                  <button key={i} onClick={() => setChartType(i)} className={`w-2 h-2 rounded-full transition-all ${chartType === i ? 'bg-emerald-500 w-4' : 'bg-neutral-800'}`} />
                ))}
              </div>
            </div>
            <div className="flex-grow h-[300px]">
              <ResponsiveContainer width="100%" height="100%">
                {chartType === 0 ? (
                  <PieChart>
                    <Pie data={results.chartData} innerRadius={70} outerRadius={100} paddingAngle={4} dataKey="value" stroke="none">
                      {results.chartData.map((e, i) => <Cell key={i} fill={e.color} />)}
                    </Pie>
                    <RechartsTooltip content={<CustomTooltip />} />
                  </PieChart>
                ) : chartType === 1 ? (
                  <BarChart data={results.chartData} layout="vertical" margin={{ left: -20, right: 20 }}>
                    <XAxis type="number" hide />
                    <YAxis dataKey="name" type="category" hide />
                    <RechartsTooltip content={<CustomTooltip />} />
                    <Bar dataKey="value" radius={[0, 10, 10, 0]}>
                      {results.chartData.map((e, i) => <Cell key={i} fill={e.color} />)}
                    </Bar>
                  </BarChart>
                ) : (
                  <RadarChart cx="50%" cy="50%" outerRadius="80%" data={results.chartData}>
                    <PolarGrid stroke="#222" />
                    <PolarAngleAxis dataKey="name" tick={{ fill: '#444', fontSize: 8, fontWeight: 900 }} />
                    <Radar name="Amount" dataKey="value" stroke="#10b981" fill="#10b981" fillOpacity={0.5} />
                    <RechartsTooltip content={<CustomTooltip />} />
                  </RadarChart>
                )}
              </ResponsiveContainer>
            </div>
          </section>
        </div>
      </main>

      <footer className="fixed bottom-0 inset-x-0 glass py-3 px-6 border-t border-white/5 flex justify-between items-center">
        <div className="text-[9px] font-black uppercase text-neutral-700 tracking-widest flex items-center">
          <span className="animate-pulse mr-2 text-emerald-500">●</span> LOCAL_CACHE_ACTIVE
        </div>
        <div className="text-[9px] font-black uppercase text-neutral-500 tracking-tighter">v3.3.0 • Architect Core</div>
      </footer>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(<App />);
    </script>
</body>
</html>