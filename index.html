<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Architect Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --emerald: #10b981;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #e5e7eb;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        .retro-mono { font-family: 'JetBrains Mono', monospace; }
        .glass {
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glow-text { text-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "recharts": "https://esm.sh/recharts@2.15.0?external=react,react-dom",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="https://esm.sh/run"></script>
    <script type="text/tsx">
import React, { useState, useMemo, useEffect, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { 
    PieChart, Pie, Cell, ResponsiveContainer, Tooltip as RechartsTooltip, 
    BarChart, Bar, XAxis, YAxis, RadarChart, PolarGrid, PolarAngleAxis, Radar,
    RadialBarChart, RadialBar, Treemap
} from 'recharts';

// --- TYPES & CONSTANTS ---
enum TimeFrame {
  HOURLY = 'Hourly', DAILY = 'Daily', WEEKLY = 'Weekly', 
  BIWEEKLY = 'Bi-Weekly', MONTHLY = 'Monthly', YEARLY = 'Yearly'
}

interface Expense {
  id: string; label: string; amount: number; 
  frequency: TimeFrame; color: string; subItems?: Expense[];
}

const TAX_BRACKETS = [
  { limit: 11600, rate: 0.10 }, { limit: 47150, rate: 0.12 },
  { limit: 100525, rate: 0.22 }, { limit: 191950, rate: 0.24 },
  { limit: 243725, rate: 0.32 }, { limit: 609350, rate: 0.35 },
  { limit: Infinity, rate: 0.37 }
];

const STATE_TAX_RATES: Record<string, number> = {
  'NONE': 0, 'CA': 0.08, 'NY': 0.06, 'TX': 0, 'FL': 0, 'WA': 0, 'IL': 0.049, 'PA': 0.03
};

// --- LOGIC UTILS ---
const convertToAnnual = (amount: number, tf: TimeFrame) => {
  if (!amount) return 0;
  switch (tf) {
    case TimeFrame.HOURLY: return amount * 8 * 5 * 52;
    case TimeFrame.DAILY: return amount * 5 * 52;
    case TimeFrame.WEEKLY: return amount * 52;
    case TimeFrame.BIWEEKLY: return amount * 26;
    case TimeFrame.MONTHLY: return amount * 12;
    case TimeFrame.YEARLY: return amount;
    default: return 0;
  }
};

const getExpenseAnnual = (exp: Expense): number => {
  const base = convertToAnnual(exp.amount, exp.frequency);
  const subs = (exp.subItems || []).reduce((acc, s) => acc + getExpenseAnnual(s), 0);
  return base + subs;
};

const calculateTax = (gross: number) => {
  let tax = 0; let rem = gross; let prev = 0;
  for (const b of TAX_BRACKETS) {
    const taxable = Math.min(rem, b.limit - prev);
    if (taxable <= 0) break;
    tax += taxable * b.rate; rem -= taxable; prev = b.limit;
  }
  return tax;
};

// --- SUB-COMPONENTS ---

const CustomTooltip = ({ active, payload }: any) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="bg-[#121212] border border-neutral-800 p-3 rounded-xl shadow-2xl backdrop-blur-md">
        <p className="text-[10px] font-black uppercase tracking-widest text-emerald-500 mb-1">{data.name}</p>
        <p className="text-sm font-bold text-white retro-mono">${Math.round(payload[0].value).toLocaleString()}</p>
      </div>
    );
  }
  return null;
};

const StatCard = ({ label, value, color }: any) => (
  <div className="glass p-4 rounded-2xl border-emerald-500/10">
    <span className="text-[9px] uppercase tracking-widest font-black text-neutral-500 block mb-1">{label}</span>
    <div className={`text-xl font-bold retro-mono ${color}`}>${Math.round(value).toLocaleString()}</div>
  </div>
);

// --- MAIN APP ---

const App = () => {
  const [income, setIncome] = useState({ amount: 0, tf: TimeFrame.HOURLY, state: 'NONE', isGross: true });
  const [expenses, setExpenses] = useState<Expense[]>([]);
  const [period, setPeriod] = useState('Month');
  const [chartIdx, setChartIdx] = useState(0);
  const [showAddExpense, setShowAddExpense] = useState(false);
  const touchStart = useRef<number | null>(null);

  // Persistence
  useEffect(() => {
    const saved = localStorage.getItem('income_arch_final_v5');
    if (saved) {
      const p = JSON.parse(saved);
      setIncome(p.income); setExpenses(p.expenses);
    }
  }, []);

  useEffect(() => {
    localStorage.setItem('income_arch_final_v5', JSON.stringify({ income, expenses }));
  }, [income, expenses]);

  const results = useMemo(() => {
    const annualGross = convertToAnnual(income.amount, income.tf);
    const fedTax = income.isGross ? calculateTax(annualGross) : 0;
    const stateTax = income.isGross ? annualGross * (STATE_TAX_RATES[income.state] || 0) : 0;
    const totalTax = fedTax + stateTax;
    
    const expenseData = expenses.map(e => ({ 
      name: e.label, 
      value: getExpenseAnnual(e), 
      color: e.color 
    }));
    const totalExp = expenseData.reduce((a, b) => a + b.value, 0);
    const takeHome = Math.max(0, annualGross - totalTax - totalExp);
    
    const f = period === 'Year' ? 1 : period === 'Month' ? 1/12 : period === 'Week' ? 1/52 : 1/260;
    
    return {
      takeHome: takeHome * f, gross: annualGross * f, tax: totalTax * f, exp: totalExp * f,
      chartData: [
        { name: 'Liquid', value: takeHome * f, color: '#10b981' },
        { name: 'Tax', value: totalTax * f, color: '#ef4444' },
        ...expenseData.map(e => ({ ...e, value: e.value * f }))
      ].filter(d => d.value > 0)
    };
  }, [income, expenses, period]);

  const addExpense = (label: string, amount: number) => {
    const newExp: Expense = {
      id: Math.random().toString(36).substr(2, 9),
      label: label || 'New Bill',
      amount: amount || 0,
      frequency: TimeFrame.MONTHLY,
      color: `hsl(${Math.random() * 360}, 70%, 50%)`,
      subItems: []
    };
    setExpenses([...expenses, newExp]);
  };

  const handleSwipe = (e: React.TouchEvent) => {
    if (e.type === 'touchstart') touchStart.current = e.touches[0].clientX;
    if (e.type === 'touchend' && touchStart.current !== null) {
      const diff = touchStart.current - e.changedTouches[0].clientX;
      if (Math.abs(diff) > 50) setChartIdx(prev => (diff > 0 ? (prev + 1) % 3 : (prev + 2) % 3));
      touchStart.current = null;
    }
  };

  return (
    <div className="min-h-screen pb-24">
      {/* Header */}
      <nav className="fixed top-0 inset-x-0 glass z-50 px-6 py-4 flex justify-between items-center border-b border-white/5">
        <div className="flex items-center space-x-2">
          <div className="w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"></div>
          <h1 className="text-xs font-black uppercase tracking-[0.3em] text-white">Income <span className="text-emerald-500">Architect</span></h1>
        </div>
        <div className="flex bg-neutral-900 rounded-xl p-1 shadow-inner">
          {['Year', 'Month', 'Week'].map(p => (
            <button 
              key={p} 
              onClick={() => setPeriod(p)} 
              className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${period === p ? 'bg-emerald-600 text-white shadow-lg' : 'text-neutral-500 hover:text-neutral-300'}`}
            >
              {p.toUpperCase()}
            </button>
          ))}
        </div>
      </nav>

      {/* Content */}
      <main className="max-w-6xl mx-auto px-4 pt-24 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        {/* Input Column */}
        <div className="lg:col-span-5 space-y-6 order-2 lg:order-1">
          <section className="glass p-6 rounded-3xl border-emerald-500/10">
            <h3 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60 mb-6">Revenue Module</h3>
            <div className="space-y-4">
              <div className="relative">
                <span className="absolute left-5 top-1/2 -translate-y-1/2 text-xl font-bold text-emerald-500 opacity-40">$</span>
                <input 
                  type="number" value={income.amount || ''} 
                  onChange={e => setIncome({...income, amount: parseFloat(e.target.value) || 0})}
                  className="w-full bg-neutral-950 border border-neutral-800 rounded-2xl py-5 pl-12 pr-4 text-3xl retro-mono text-white outline-none focus:border-emerald-500/50 transition-all"
                  placeholder="0.00"
                />
              </div>
              <div className="grid grid-cols-3 gap-2">
                <select value={income.tf} onChange={e => setIncome({...income, tf: e.target.value as TimeFrame})} className="bg-neutral-900 border border-neutral-800 rounded-xl px-3 py-4 text-[10px] font-black text-white outline-none appearance-none cursor-pointer">
                  {Object.values(TimeFrame).map(t => <option key={t} value={t}>{t}</option>)}
                </select>
                <button onClick={() => setIncome({...income, isGross: !income.isGross})} className={`rounded-xl text-[10px] font-black transition-all ${income.isGross ? 'bg-emerald-600 text-white shadow-lg' : 'bg-neutral-800 text-neutral-500'}`}>{income.isGross ? 'GROSS' : 'NET'}</button>
                <select value={income.state} onChange={e => setIncome({...income, state: e.target.value})} className="bg-neutral-900 border border-neutral-800 rounded-xl px-3 py-4 text-[10px] font-black text-white outline-none appearance-none cursor-pointer">
                  <option value="NONE">FED ONLY</option>
                  <option value="CA">CALIFORNIA</option>
                  <option value="NY">NEW YORK</option>
                  <option value="TX">TEXAS</option>
                  <option value="WA">WASHINGTON</option>
                </select>
              </div>
            </div>
          </section>

          <section className="glass p-6 rounded-3xl border-emerald-500/10">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60">Liability Architect</h3>
              <button 
                onClick={() => addExpense('', 0)}
                className="bg-emerald-500/10 text-emerald-500 px-4 py-2 rounded-xl text-[9px] font-black uppercase border border-emerald-500/20 hover:bg-emerald-500/20"
              >
                + ADD ASSET
              </button>
            </div>
            <div className="space-y-3">
              {expenses.map(ex => (
                <div key={ex.id} className="glass p-4 rounded-2xl flex items-center justify-between border-transparent hover:border-emerald-500/20 animate-in">
                  <div className="flex items-center space-x-3">
                    <div className="w-3 h-3 rounded-full shrink-0 shadow-sm" style={{backgroundColor: ex.color}} />
                    <input className="bg-transparent border-none outline-none text-xs font-bold text-white w-24" value={ex.label} onChange={e => setExpenses(expenses.map(x => x.id === ex.id ? {...x, label: e.target.value} : x))} />
                  </div>
                  <div className="flex items-center space-x-3">
                    <input type="number" className="bg-transparent border-none outline-none text-right text-xs retro-mono font-bold text-neutral-400 w-20" value={ex.amount || ''} onChange={e => setExpenses(expenses.map(x => x.id === ex.id ? {...x, amount: parseFloat(e.target.value) || 0} : x))} />
                    <button onClick={() => setExpenses(expenses.filter(x => x.id !== ex.id))} className="text-neutral-700 hover:text-red-500 transition-colors">&times;</button>
                  </div>
                </div>
              ))}
              {expenses.length === 0 && <div className="py-12 text-center text-[10px] uppercase font-bold text-neutral-800 tracking-widest">Blueprint empty</div>}
            </div>
          </section>
        </div>

        {/* Output Column */}
        <div className="lg:col-span-7 space-y-6 order-1 lg:order-2 lg:sticky lg:top-24">
          <section className="glass rounded-[2.5rem] p-8 border-emerald-500/20 bg-gradient-to-br from-[#0a0a0a] to-black relative overflow-hidden">
            <div className="absolute top-0 right-0 p-8 opacity-5">
               <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></svg>
            </div>
            <span className="text-[10px] uppercase font-black tracking-[0.2em] text-emerald-500/80">Net Disposable ({period})</span>
            <h2 className="text-6xl md:text-8xl font-black text-white glow-text mt-2 retro-mono break-all">${Math.round(results.takeHome).toLocaleString()}</h2>
            <div className="grid grid-cols-3 gap-4 mt-8 pt-8 border-t border-white/5">
              <StatCard label="GROSS" value={results.gross} color="text-neutral-400" />
              <StatCard label="TAXES" value={results.tax} color="text-red-500/80" />
              <StatCard label="BILLS" value={results.exp} color="text-blue-500/80" />
            </div>
          </section>

          <section 
            className="glass p-6 rounded-[2.5rem] h-[400px] flex flex-col relative select-none"
            onTouchStart={handleSwipe}
            onTouchEnd={handleSwipe}
          >
             <div className="flex justify-between items-center mb-8">
                <h4 className="text-[10px] font-black uppercase tracking-widest text-emerald-500/60">Asset Analytics</h4>
                <div className="flex gap-1.5">
                  {[0, 1, 2].map(i => (
                    <button key={i} onClick={() => setChartIdx(i)} className={`w-2 h-2 rounded-full transition-all ${chartIdx === i ? 'bg-emerald-500 w-5' : 'bg-neutral-800 hover:bg-neutral-700'}`} />
                  ))}
                </div>
             </div>
             <div className="flex-grow">
               <ResponsiveContainer width="100%" height="100%">
                  {chartIdx === 0 ? (
                    <PieChart>
                      <Pie data={results.chartData} innerRadius={65} outerRadius={95} paddingAngle={5} dataKey="value" stroke="none">
                        {results.chartData.map((e, i) => <Cell key={i} fill={e.color} />)}
                      </Pie>
                      <RechartsTooltip content={<CustomTooltip />} />
                    </PieChart>
                  ) : chartIdx === 1 ? (
                    <BarChart data={results.chartData} layout="vertical" margin={{ left: -20, right: 20 }}>
                      <XAxis type="number" hide />
                      <YAxis dataKey="name" type="category" hide />
                      <Bar dataKey="value" radius={[0, 10, 10, 0]}>
                        {results.chartData.map((e, i) => <Cell key={i} fill={e.color} />)}
                      </Bar>
                      <RechartsTooltip content={<CustomTooltip />} />
                    </BarChart>
                  ) : (
                    <RadarChart cx="50%" cy="50%" outerRadius="80%" data={results.chartData}>
                      <PolarGrid stroke="#222" />
                      <PolarAngleAxis dataKey="name" tick={{ fill: '#444', fontSize: 8, fontWeight: 900 }} />
                      <Radar name="Amount" dataKey="value" stroke="#10b981" fill="#10b981" fillOpacity={0.5} />
                      <RechartsTooltip content={<CustomTooltip />} />
                    </RadarChart>
                  )}
               </ResponsiveContainer>
             </div>
             <div className="mt-4 text-center text-[8px] font-black text-neutral-800 uppercase tracking-[0.5em] animate-pulse">Swipe to rotate viewports</div>
          </section>
        </div>
      </main>

      {/* Footer */}
      <footer className="fixed bottom-0 inset-x-0 glass py-3 px-6 border-t border-white/5 flex justify-between items-center text-[9px] font-black uppercase text-neutral-600 tracking-widest">
        <div className="flex items-center"><span className="w-1.5 h-1.5 rounded-full bg-emerald-500 mr-2"></span> ARCH_SECURE_V5</div>
        <div>LOCAL_SYNC: ACTIVE</div>
      </footer>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(<App />);
    </script>
</body>
</html>